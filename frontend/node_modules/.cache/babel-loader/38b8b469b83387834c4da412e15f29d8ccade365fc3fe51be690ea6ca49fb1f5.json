{"ast":null,"code":"import axios from\"axios\";import{useContext,useEffect,useReducer}from\"react\";import{useNavigate,useParams}from\"react-router-dom\";import{Helmet}from\"react-helmet-async\";import LoadingBox from\"../components/LoadingBox\";import MessageBox from\"../components/MessageBox\";import{getError}from\"../utils\";import{Store}from\"../Store\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const reducer=(state,action)=>{switch(action.type){case\"FETCH_REQUEST\":return{...state,loading:true};case\"FETCH_SUCCESS\":return{...state,product:action.payload,loading:false};case\"FETCH_FAIL\":return{...state,loading:false,error:action.payload};default:return state;}};function ProductScreen(){const navigate=useNavigate();const params=useParams();const{slug}=params;const[{loading,error,product},dispatch]=useReducer(reducer,{product:[],loading:true,error:\"\"});useEffect(()=>{const fetchData=async()=>{dispatch({type:\"FETCH_REQUEST\"});try{const result=await axios.get(\"/api/products/slug/\".concat(slug));dispatch({type:\"FETCH_SUCCESS\",payload:result.data});}catch(err){dispatch({type:\"FETCH_FAIL\",payload:getError(err)});}};fetchData();},[slug]);const{state,dispatch:ctxDispatch}=useContext(Store);const{cart}=state;const addToCartHandler=async()=>{const existItem=cart.cartItems.find(x=>x._id===product._id);const quantity=existItem?existItem.quantity+1:1;const{data}=await axios.get(\"/api/products/\".concat(product._id));if(data.countInStock<quantity){window.alert(\"Sorry. Product is out of stock\");return;}ctxDispatch({type:\"CART_ADD_ITEM\",payload:{...product,quantity}});navigate(\"/cart\");};return loading?/*#__PURE__*/_jsx(LoadingBox,{}):error?/*#__PURE__*/_jsx(MessageBox,{variant:\"danger\",children:error}):/*#__PURE__*/_jsxs(\"div\",{className:\"main-product\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"main-product-image\",src:product.image,alt:product.name}),/*#__PURE__*/_jsx(Helmet,{children:/*#__PURE__*/_jsx(\"title\",{children:product.name})}),/*#__PURE__*/_jsxs(\"div\",{className:\"product-info\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"italics\",children:product.name}),/*#__PURE__*/_jsxs(\"h3\",{children:[\"$\",product.price]}),\"Description:\",/*#__PURE__*/_jsx(\"h2\",{className:\"main-product-desc\",children:product.description}),/*#__PURE__*/_jsx(\"div\",{children:product.countInStock>0?/*#__PURE__*/_jsx(\"div\",{children:\"In Stock\"}):/*#__PURE__*/_jsx(\"div\",{className:\"unavailable\",children:\"Unavailable\"})}),product.countInStock>0&&/*#__PURE__*/_jsx(\"button\",{className:\"product-cart-button\",onClick:addToCartHandler,children:\"Add to Cart\"})]})]});}export default ProductScreen;","map":{"version":3,"names":["axios","useContext","useEffect","useReducer","useNavigate","useParams","Helmet","LoadingBox","MessageBox","getError","Store","jsx","_jsx","jsxs","_jsxs","reducer","state","action","type","loading","product","payload","error","ProductScreen","navigate","params","slug","dispatch","fetchData","result","get","concat","data","err","ctxDispatch","cart","addToCartHandler","existItem","cartItems","find","x","_id","quantity","countInStock","window","alert","variant","children","className","src","image","alt","name","price","description","onClick"],"sources":["/Users/jtlovato/Documents/GitHub/AOPortfolio/AyodelePortfolio/frontend/src/screens/ProductScreen.js"],"sourcesContent":["import axios from \"axios\";\nimport { useContext, useEffect, useReducer } from \"react\";\nimport { useNavigate, useParams } from \"react-router-dom\";\nimport { Helmet } from \"react-helmet-async\";\nimport LoadingBox from \"../components/LoadingBox\";\nimport MessageBox from \"../components/MessageBox\";\nimport { getError } from \"../utils\";\nimport { Store } from \"../Store\";\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case \"FETCH_REQUEST\":\n      return { ...state, loading: true };\n    case \"FETCH_SUCCESS\":\n      return { ...state, product: action.payload, loading: false };\n    case \"FETCH_FAIL\":\n      return { ...state, loading: false, error: action.payload };\n    default:\n      return state;\n  }\n};\n\nfunction ProductScreen() {\n  const navigate = useNavigate();\n  const params = useParams();\n  const { slug } = params;\n\n  const [{ loading, error, product }, dispatch] = useReducer(reducer, {\n    product: [],\n    loading: true,\n    error: \"\",\n  });\n\n  useEffect(() => {\n    const fetchData = async () => {\n      dispatch({ type: \"FETCH_REQUEST\" });\n      try {\n        const result = await axios.get(`/api/products/slug/${slug}`);\n        dispatch({ type: \"FETCH_SUCCESS\", payload: result.data });\n      } catch (err) {\n        dispatch({ type: \"FETCH_FAIL\", payload: getError(err) });\n      }\n    };\n    fetchData();\n  }, [slug]);\n\n  const { state, dispatch: ctxDispatch } = useContext(Store);\n\n  const { cart } = state;\n  const addToCartHandler = async () => {\n    const existItem = cart.cartItems.find((x) => x._id === product._id);\n    const quantity = existItem ? existItem.quantity + 1 : 1;\n    const { data } = await axios.get(`/api/products/${product._id}`);\n    if (data.countInStock < quantity) {\n      window.alert(\"Sorry. Product is out of stock\");\n      return;\n    }\n    ctxDispatch({\n      type: \"CART_ADD_ITEM\",\n      payload: { ...product, quantity },\n    });\n    navigate(\"/cart\");\n  };\n\n  return loading ? (\n    <LoadingBox />\n  ) : error ? (\n    <MessageBox variant='danger'>{error}</MessageBox>\n  ) : (\n    <div className='main-product'>\n      <img\n        className='main-product-image'\n        src={product.image}\n        alt={product.name}\n      ></img>\n      <Helmet>\n        <title>{product.name}</title>\n      </Helmet>\n      <div className='product-info'>\n        <h1 className='italics'>{product.name}</h1>\n        <h3>${product.price}</h3>\n        Description:\n        <h2 className='main-product-desc'>{product.description}</h2>\n        <div>\n          {product.countInStock > 0 ? (\n            <div>In Stock</div>\n          ) : (\n            <div className='unavailable'>Unavailable</div>\n          )}\n        </div>\n        {product.countInStock > 0 && (\n          <button className='product-cart-button' onClick={addToCartHandler}>\n            Add to Cart\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}\nexport default ProductScreen;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}